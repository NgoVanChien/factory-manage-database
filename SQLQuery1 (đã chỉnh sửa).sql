CREATE DATABASE BTL_QUANLYXUONGSXBANHKEO
USE BTL_QUANLYXUONGSXBANHKEO
GO

CREATE TABLE CHUXUONG
(
	TENCHU_XG NVARCHAR(30) NOT NULL,
	DIACHI NVARCHAR(100),
	SDT INT,
	PRIMARY KEY(TENCHU_XG)
)
GO
CREATE TABLE NHANVIEN 
(
	TENNV NVARCHAR(30),
	MANV INT NOT NULL,
	SDT INT,
	GIOITINH NVARCHAR(4),
	DIACHI NVARCHAR(100)
	PRIMARY KEY(MANV),
	TENCHU_XG NVARCHAR(30),
	FOREIGN KEY (TENCHU_XG) REFERENCES CHUXUONG(TENCHU_XG)
)
GO
CREATE TABLE NGUYENLIEU 
(
	TENNL NVARCHAR(50) NOT NULL,
	SOLUONG INT,
	DONGIA INT,
	TONGTIEN INT ,
	PRIMARY KEY(TENNL)
)

GO
CREATE TABLE NHAP
(
	MANV INT NOT NULL,
	TENNL NVARCHAR(50) NOT NULL,
	NGAYNHAP DATE,
	PRIMARY KEY(MANV, TENNL)
)
GO 
ALTER TABLE dbo.NHAP ADD FOREIGN KEY (MANV) REFERENCES dbo.NHANVIEN (MANV),
FOREIGN KEY (TENNL) REFERENCES dbo.NGUYENLIEU (TENNL)
GO
CREATE TABLE SANPHAM
(
	MASP CHAR(10) NOT NULL,
	TENSP NVARCHAR(50),
	NSX DATE,
	HSD DATE,
	THANHPHAN NVARCHAR(100),
	
	PRIMARY KEY(MASP)
)
GO
CREATE TABLE DUNGLAM
(
	TENNL NVARCHAR(50) NOT NULL,
	MASP CHAR(10) NOT NULL,
	PRIMARY KEY(TENNL, MASP),
)
GO
-- đưa khóa ngoại vào trong table
ALTER TABLE DUNGLAM ADD FOREIGN KEY (TENNL) REFERENCES dbo.NGUYENLIEU(TENNL),
	FOREIGN KEY (MASP) REFERENCES dbo.SANPHAM(MASP)
GO 
CREATE TABLE SANXUAT
(
	MANV INT NOT NULL,
	MASP CHAR(10) NOT NULL,
	PRIMARY KEY(MANV, MASP)
)
GO
-- đưa khóa ngoại vào trong table luôn
ALTER TABLE SANXUAT ADD FOREIGN KEY (MANV) REFERENCES dbo.NHANVIEN(MANV),
	FOREIGN KEY (MASP) REFERENCES dbo.SANPHAM(MASP)
GO 
CREATE TABLE DOITAC
(
	MADT CHAR(10) NOT NULL,
	TENDT NVARCHAR(30),
	DIACHI NVARCHAR(100),
	SDT INT,
	TENCH NVARCHAR(50),
	TENCHU_XG NVARCHAR(30),
	PRIMARY KEY(MADT),
	FOREIGN KEY (TENCHU_XG) REFERENCES dbo.CHUXUONG(TENCHU_XG)
)
CREATE TABLE HOADONPHANPHOI
(
	MAPP CHAR(10) NOT NULL,
	NGAYPP DATE,
	SOLUONGSP INT,
	TONGTIEN INT,
	MADT CHAR(10),
	PRIMARY KEY(MAPP),
	FOREIGN KEY (MADT) REFERENCES dbo.DOITAC(MADT)
)
ALTER TABLE dbo.HOADONPHANPHOI ADD TONGTIEN INT

CREATE TABLE PHANPHOI
(
	MAPP CHAR(10) NOT NULL,
	MADT CHAR(10) NOT NULL,
	PRIMARY KEY(MAPP, MADT)
)
GO 
ALTER TABLE dbo.PHANPHOI ADD FOREIGN KEY (MAPP) REFERENCES dbo.HOADONPHANPHOI(MAPP), 
FOREIGN KEY (MADT) REFERENCES dbo.DOITAC(MADT)
GO 
CREATE TABLE CHITIETHOADON
(
	MAHOADON CHAR(10) NOT NULL,
	TENHANG NVARCHAR(100),
	SL int,
	DONGIA int,
	THANHTIEN int,
	MAPP CHAR(10),
	PRIMARY KEY (MAHOADON),
	FOREIGN KEY (MAPP) REFERENCES dbo.HOADONPHANPHOI(MAPP)
	)
GO
-- Nhap table CHUXUONG
INSERT INTO dbo.CHUXUONG VALUES  ( N'Nguyễn Văn An', N'TP.HCM',0941112233 )
-- Nhap table NHANVIEN
INSERT INTO dbo.NHANVIEN VALUES  ( N'Lê Văn A', 001, 0941234567,N'nam', N'Đồng Nai', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Lê Thị B', 002, 0944324323, N'Nữ', N'Đồng Nai', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Trần Văn C', 003, 0925433544,N'nam', N'TP.HCM', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Phạm Thị T', 004, 0974328643,N'nữ', N'Bình Dương', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Hoàng Văn H', 005, 0941343169,N'nam', N'TP.HCM', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Lê Văn G', 006, 0986138168,N'nam', N'Đồng Nai', N'Nguyễn Văn An' )
INSERT INTO dbo.NHANVIEN VALUES  ( N'Phạm Thị N', 007, 0941234567, N'nữ', N'Bình Dương', N'Nguyễn Văn An' )
-- Nhap table NGUYENLIEU
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Bột mì', 50, 20000, NULL )
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Sữa', 100,15000,  NULL )
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Đường',50 ,20000,  NULL)
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Phụ gia',100 ,50000, NULL )
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Kem tươi',20,30000, NULL )
INSERT INTO dbo.NGUYENLIEU VALUES ( N'Trứng',1000,2000, NULL )
-- Nhap table NHAP
INSERT INTO dbo.NHAP VALUES  ( 001, N'Bột mì', '2020/06/06')
INSERT INTO dbo.NHAP VALUES  ( 001, N'Sữa', '2020/06/06')  
INSERT INTO dbo.NHAP VALUES  ( 001, N'Đường', '2020/06/09')
INSERT INTO dbo.NHAP VALUES  ( 001, N'Phụ gia', '2020/06/09')
INSERT INTO dbo.NHAP VALUES  ( 001, N'Kem tươi', '2020/06/10')
INSERT INTO dbo.NHAP VALUES  ( 001, N'Trứng', '2020/06/10')
INSERT INTO dbo.NHAP VALUES  ( 002, N'Bột mì', '2020/05/01')
INSERT INTO dbo.NHAP VALUES  ( 002, N'Sữa', '2020/05/01')  
INSERT INTO dbo.NHAP VALUES  ( 002, N'Đường', '2020/05/03')
INSERT INTO dbo.NHAP VALUES  ( 002, N'Phụ gia', '2020/05/03')
INSERT INTO dbo.NHAP VALUES  ( 002, N'Kem tươi', '2020/05/04')
INSERT INTO dbo.NHAP VALUES  ( 002, N'Trứng', '2020/05/04')
INSERT INTO dbo.NHAP VALUES  ( 003, N'Bột mì', '2020/03/27')
INSERT INTO dbo.NHAP VALUES  ( 003, N'Sữa', '2020/03/27')  
INSERT INTO dbo.NHAP VALUES  ( 003, N'Đường', '2020/03/30')
INSERT INTO dbo.NHAP VALUES  ( 003, N'Phụ gia', '2020/03/30')
INSERT INTO dbo.NHAP VALUES  ( 003, N'Kem tươi', '2020/03/31')
INSERT INTO dbo.NHAP VALUES  ( 003, N'Trứng', '2020/03/31')
INSERT INTO dbo.NHAP VALUES  ( 005, N'Bột mì', '2020/02/22')
INSERT INTO dbo.NHAP VALUES  ( 005, N'Sữa', '2020/02/22')  
INSERT INTO dbo.NHAP VALUES  ( 005, N'Đường', '2020/02/25')
INSERT INTO dbo.NHAP VALUES  ( 005, N'Phụ gia', '2020/02/25')
INSERT INTO dbo.NHAP VALUES  ( 005, N'Kem tươi', '2020/02/26')
INSERT INTO dbo.NHAP VALUES  ( 005, N'Trứng', '2020/02/26')
INSERT INTO dbo.NHAP VALUES  ( 006, N'Bột mì', '2020/01/17') 
INSERT INTO dbo.NHAP VALUES  ( 006, N'Sữa', '2020/01/17') 
INSERT INTO dbo.NHAP VALUES  ( 006, N'Đường', '2020/01/20')
INSERT INTO dbo.NHAP VALUES  ( 006, N'Phụ gia', '2020/01/20')
INSERT INTO dbo.NHAP VALUES  ( 006, N'Kem tươi', '2020/01/21')
INSERT INTO dbo.NHAP VALUES  ( 006, N'Trứng', '2020/01/21')
-- Nhap table SANPHAM
INSERT INTO dbo.SANPHAM VALUES  ( 'SP1', N'Bánh quy', '2020/01/25', '2021/07/25', N'Bột mì, đường, trứng',)
INSERT INTO dbo.SANPHAM VALUES  ( 'SP2', N'Bánh Bông lan', '2020/01/30', '2021/02/15', N'Bột mì, đường, trứng, kem tươi, phụ gia')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP3', N'Kẹo dẻo', '2020/02/10', '2022/02/10', N'Đường, Kem tươi, sữa, phụ gia')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP4', N'Kẹo sữa', '2020/02/11', '2022/03/11', N'Đường, sữa')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP5', N'Bánh trứng', '2020/02/20', '2021/02/20', N'Bột mì, đường, trứng')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP6', N'Chocopie', '2020/02/22', '2021/08/22', N'Bột mì, đường, trứng, sữa, kem tươi, phụ gia')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP7', N'Kẹo trái cây', '2020/01/25', '2021/01/25', N'Đường, sữa, phụ gia')
INSERT INTO dbo.SANPHAM VALUES  ( 'SP8', N'Bánh gạo', '2020/03/05', '2021/03/05', N'Bột mì, đường, phụ gia')
-- Nhap table DUNGLAM
INSERT INTO dbo.DUNGLAM VALUES  ( N'Bột mì', 'SP1')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Bột mì', 'SP2')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Bột mì', 'SP5')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Bột mì', 'SP6')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Bột mì', 'SP8')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Sữa', 'SP3')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Sữa', 'SP4')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Sữa', 'SP6')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Sữa', 'SP7')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP1')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP2')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP3')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP4')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP5')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP6')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP7')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Đường', 'SP8')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Phụ gia', 'SP2')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Phụ gia', 'SP3')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Phụ gia', 'SP5')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Phụ gia', 'SP6')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Phụ gia', 'SP7')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Kem tươi', 'SP2')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Kem tươi', 'SP3')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Kem tươi', 'SP5')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Trứng', 'SP1')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Trứng', 'SP2')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Trứng', 'SP4')
INSERT INTO dbo.DUNGLAM VALUES  ( N'Trứng', 'SP5')
-- Nhap table SANXUAT
INSERT INTO dbo.SANXUAT VALUES  ( 001, 'SP1' )
INSERT INTO dbo.SANXUAT VALUES  ( 001, 'SP8' )
INSERT INTO dbo.SANXUAT VALUES  ( 002, 'SP2' )
INSERT INTO dbo.SANXUAT VALUES  ( 002, 'SP3' )
INSERT INTO dbo.SANXUAT VALUES  ( 003, 'SP3' )
INSERT INTO dbo.SANXUAT VALUES  ( 003, 'SP4' )
INSERT INTO dbo.SANXUAT VALUES  ( 004, 'SP1' )
INSERT INTO dbo.SANXUAT VALUES  ( 004, 'SP2' )
INSERT INTO dbo.SANXUAT VALUES  ( 004, 'SP3' )
INSERT INTO dbo.SANXUAT VALUES  ( 004, 'SP4' )
INSERT INTO dbo.SANXUAT VALUES  ( 005, 'SP5' )
INSERT INTO dbo.SANXUAT VALUES  ( 005, 'SP6' )
INSERT INTO dbo.SANXUAT VALUES  ( 006, 'SP6' )
INSERT INTO dbo.SANXUAT VALUES  ( 006, 'SP7' )
INSERT INTO dbo.SANXUAT VALUES  ( 007, 'SP5' )
INSERT INTO dbo.SANXUAT VALUES  ( 007, 'SP6' )
INSERT INTO dbo.SANXUAT VALUES  ( 007, 'SP7' )
INSERT INTO dbo.SANXUAT VALUES  ( 007, 'SP8' )
-- Nhap table DOITAC
INSERT INTO dbo.DOITAC VALUES  ( 'DT1', N'Đoàn Văn H', N'Hà Nội', 0944935486, N'Kinh Đô', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT2', N'Phạm Toàn T', N'TP.HCM', 0981254698, N'Vạn Thọ', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT3', N'Hà Anh T', N'Hà Nội', 0940319066, N'T-FOOD', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT4', N'Nguyễn Công P', N'Nghệ An', 0933565589, N'VNCT', N'Nguyễn Văn A')
INSERT INTO dbo.DOITAC VALUES  ( 'DT5', N'Nguyễn Quang H', N'TP.HCM', 0931239985, N'HOTAYMC', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT6', N'Trần Đức B', N'Đà Nẵng', 0940495252, N'MEOWMEOW', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT7', N'Phan Tấn T', N'Đồng Tháp', 0934460175, N'SUSAN', N'Nguyễn Văn An')
INSERT INTO dbo.DOITAC VALUES  ( 'DT8', N'Trương Tuấn T', N'Hải Phòng', 0932231220, N'GAMSELA', N'Nguyễn Văn An')
-- Nhap table HOADONPHANPHOI
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP1', '2020/02/22', 3, NULL,'DT1')
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP2', '2020/02/27', 4, NULL,'DT2' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP3', '2020/03/15', 4, NULL,'DT2' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP4', '2020/03/27', 5, NULL,'DT3')
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP5', '2020/03/31', 4, NULL,'DT4' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP6', '2020/05/10', 6, NULL,'DT5' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP7', '2020/05/30', 5, NULL,'DT6' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP8', '2020/06/09', 4, NULL,'DT7' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP9', '2020/06/10', 5, NULL,'DT7' )
INSERT INTO dbo.HOADONPHANPHOI VALUES  ( 'PP10', '2020/06/15', 7, NULL,'DT8')
-- Nhap table PHANPHOI
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP1', 'DT1' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP2', 'DT2' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP3', 'DT2' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP4', 'DT3' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP5', 'DT4' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP6', 'DT5' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP7', 'DT6' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP8', 'DT7' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP9', 'DT7' )
INSERT INTO dbo.PHANPHOI VALUES  ( 'PP10', 'DT8' )
-- Nhap table CHITIETHOADON
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD1', N'Bánh quy, bánh bông lan, kẹo dẻo', 3,750000,NULL, 'PP1')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD2', N'Bánh quy, bánh bông lan, kẹo dẻo, kẹo sữa', 4, 10000000,NULL, 'PP2')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD3', N'Bánh quy, bánh bông lan, kẹo dẻo, kẹo sữa', 4, 10000000,NULL 'PP2')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD4', N'Bánh quy, bánh bông lan, bánh trứng, kẹo sữa, chocopie', 5, 12500000,NULL, 'PP3')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD5', N'Bánh quy, bánh bông lan, chocopie, bánh trứng', 4, 10000000,NULL, 'PP4')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD6', N'Bánh quy, bánh bông lan, bánh gạo, chocopie, kẹo trái cây, kẹo sữa', 6, 1500000,NULL, 'PP5')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD7', N'Bánh quy, bánh bông lan, bánh trứng, chocopie, bánh gạo', 5, 1250000,NULL, 'PP6')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD8', N'Kẹo dẻo kẹo sữa kẹo trái cây, bánh gạo', 4, 1000000,NULL, 'PP7')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD9', N'Chocopie, bánh trứng, kẹo dẻo, kẹo trái cây, bánh gạo', 5, 12500000,NULL, 'PP7')
INSERT INTO dbo.CHITIETHOADON VALUES ( 'HD10', N'Bánh quy, bánh bông lan, kẹo dẻo, kẹo sữa, chocopie, kẹo trái cây, bánh gạo', 7, 17500000,NULL, 'PP8')

GO

-- CÁC CÂU TRUY VẤN 



--1 Xuất ra thông tin các sản phẩm có trong cửa hàng
SELECT * FROM SANPHAM AS SP

--2 Xuất ra tên và địa chỉ các nhân viên nữ của xưởng
SELECT TENNV ,DIACHI FROM dbo.NHANVIEN WHERE GIOITINH = N'Nữ'
 
--3 Hiển thị tên nhân viên bắt đầu bằng chữ L
SELECT * FROM NHANVIEN WHERE TENNV LIKE 'L%' 

--4 Sắp xếp các sản phẩm theo ngày sản xuất 
SELECT * FROM SANPHAM ORDER BY NSX   

--5 Sắp xếp các nguyên liệu theo giá giảm dần
SELECT * FROM dbo.NGUYENLIEU ORDER BY DONGIA DESC    

--6 Liệt kê các nguyên liệu có giá trên 1000000đ
SELECT * FROM dbo.NGUYENLIEU WHERE TONGTIEN > 1000000

--7 Đếm xem xưởng đã sản xuất được bao nhiêu sản phẩm
SELECT COUNT(MASP) AS N'Số lượng sản phẩm' FROM dbo.SANPHAM 

--8 Xuất ra thông tin các hóa đơn được phân phối trong tháng 5
SELECT * FROM dbo.HOADONPHANPHOI WHERE MONTH(NGAYPP) = '5'

--9 Xuất ra thông tin các nhân viên sản xuất 3 sản phẩm trở lên
SELECT * FROM dbo.NHANVIEN AS nv
WHERE 3 < 
( 
	SELECT COUNT(*) FROM dbo.SANXUAT
	WHERE MANV = nv.MANV
) 

--10 Xuất ra giá trị nguyên liệu cao nhất và thấp nhất
SELECT MAX(TONGTIEN) AS Max, MIN(TONGTIEN) AS Min FROM dbo.NGUYENLIEU

--11.	In ra danh sách các đối tác (MADT, TENDT) đã mua hàng trong ngày 2020/02/22
SELECT DT.MADT, TENDT
FROM DOITAC  DT INNER JOIN HOADONPHANPHOI HD
ON DT.MADT = HD.MADT
WHERE NGAYPP = '2020/02/22'

--12 Cho biết tên dối tác 
SELECT TENDT
FROM DOITAC

--13 dua ra 3 ma san pham trong dach sach
SELECT TOP 3 MASP
FROM SANPHAM




--14 CÂU HỎI VẤN ĐÁP - Cho biết thông tin đối tác mua nhều sản phẩm nhất 
SELECT *
FROM DOITAC
WHERE MaDT =
(SELECT TOP 1 MADT
FROM HOADONPHANPHOI
ORDER BY SOLUONGPP DESC)